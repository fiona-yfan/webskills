<html>

<head>
    <title>Object.defineProperty</title>

</head>

<body>
    <div id="div">
        <p>Vue2.0 响应式数据:Object:defineProperty</p>
        <input type="text" id="input1" />
        <p id="show">
        </p>
    </div>
    <script>
        let obj = {};
        Object.defineProperty(obj, 'txt', {
            get() {
                return obj;
            },
            set(newText) {
                //obj.txt = newText;
                document.querySelector("input").value = newText;
                document.querySelector("p").innerHTML = newText;
            }
        });
        document.querySelector("input").addEventListener('keyup', (e) => { obj.txt = e.target.value; });


    </script>
    <script type="text/javascript">
        // 闭包 做用：1 累加器

        function add() {
            var count = 0;
            function increment() {
                return count++;
            }
            return increment;
        }
        var mycounter = add();
        console.log(mycounter());
        console.log(mycounter());

        // 作用2：缓存（存储结构）
        function test() {

            var num = 100;
            function add() {
                num++;
                console.log(num);
            }
            function sub() {
                num--;
                console.log(num);
            }
            return [add, sub];
        }
        var myArr = test();
        myArr[0]();
        myArr[1]();

        //共享变量 food 缓存了food
        function eater() {
            var food = "";
            var obj = {
                eat: function () {
                    console.log("i am eating " + food);
                },
                push: function (myfood) {
                    food = myfood;
                }
            }
            return obj;
        }
        var aaa = eater();
        aaa.push("apple");
        aaa.eat();

        // 闭包作用3 封装，变量私有化
        // 闭包作用4 函数模块化

        ///**************
        // 立即执行函数
        // (function(){}()) 立即执行函数的格式
        // 代码精简化
        // without agrument
        (function () {
            var test = 123;
            console.log(123);
        }());
        // with agrument
        var num = (function (a, b, c) {
            return a * b + c;
        }(2, 5, 7));
        console.log(num);

        ///***********8888
        ///只有表达式才能被执行符号执行 （）
        ///当表达式被立即执行，名字被省略
        var test = function () { }();
        ///test undefined
        (function test1() { console.log("instanst exceuted") }());// recommandation by w3c
        (function test2() { console.log("instanst exceuted") })();
        ///***********
        /// 一个有意思的例子，可以使用立即执行函数 +闭包解决
        function loopArray() {
            let arr = [];
            for (var i = 0; i < 10; i++) {
                arr[i] = function () {
                    document.write(i + " ");
                }
            }
            return arr;
        }
        function loopArray2() {
            let arr = [];
            for (var i = 0; i < 10; i++) {
                (function (j) {
                    arr[j] = function () {
                        document.write(j + " ");
                    }
                }(i));
            }
            return arr;
        }
        function loopArray3() {
            let arr = [];
            // using let
            for (let i = 0; i < 10; i++) {
                arr[i] = function () {
                    document.write(i + " ");
                }
            }
            return arr;
        }
        var arr1 = loopArray();
        var arr2 = loopArray2();
        var arr3 = loopArray3();
        for (let j = 0; j < 10; j++) {
            arr1[j]();//10 10 10 10 10 10 10 10 10 10
        }
        for (let j = 0; j < 10; j++) {
            arr2[j]();//0 1 2 3 4 5 6 7 8 9
        }
        for (let j = 0; j < 10; j++) {
            arr3[j]();//0 1 2 3 4 5 6 7 8 9
        }



        ///该方法不会报错，会把 （1，2，3，4）换行，test 依然是函数定义
        function compute(a, b, c, d) {
            console.log(a + b + c + d);
        } (1, 2, 3, 4)


        // count string length
        function getStringLength(sentance) {
            var count, len;
            count = len = sentance.length;
            for (let index = 0; index < len; index++) {
                if (sentance.charCodeAt(index) > 255) {
                    count++;
                }

            }
            return count;
        }

        // comma 逗号运符
        // 按顺序计算运行，仅返回最后一个计算结果
        let a = (2 - 1, 2 + 1);// a=3;
        let f = (function f() {
            return "1";
        },
            function g() {
                return 2;
            })();
        console.log(typeof f);// number

        var x = 1;
        if (function f() { }) {// 括号里面是表达式，不是函数声明
            x += typeof f;// 任何undefined的对象使用都会报错，除非用typeof， typeof 返回的是string类型
        }
        console.log(x);// 1undefined
    </script>
</body>

</html>